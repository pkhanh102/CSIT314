<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RocketMeal</title>
    <link rel="stylesheet" href="food.css">
</head>

<body>
    <header>
        <!-- NAVIGATION BAR -->
        <h1 class="logo_name">ROCKETMEAL</h1>
        <div>
            <p class="logo_description">30 minutes</p>
            <ul class="navigation_bar">
                <li class="nav_list"><a href="login.html">Login</a></li>
                <li class="nav_list"><a href="#about-us">About Us</a></li>
                <li class="nav_list"><a href="#">Food Categories</a></li>
                <li class="nav_list"><a href="index.html">Home</a></li>
            </ul>
        </div>
    </header>

    <main class="main">

        <!-- Search bar -->
        <div class="search_container">
            <input type="text" placeholder="Search by keyword" id="search-box" class="search-box">
            <button type="button" class="search-button" id="search-button">
              <img src="images/filter.png" alt="Search Icon" class="search-icon">
              <ul id="filter-options">
                <li data-filter="distance">By Distance</li>
                <li data-filter="rating">By Rating</li>
              </ul>
            </button>
        </div>

        <!-- Categories bar -->
        <section class="category">
          <h2 class="category-title">Food Categories</h2>

          <div class="category_container">
            <div class="category_item">
              <img src="images/category/asian.png" alt="Asian Image" class="category_img">
              <p class="category_text"><a href="#">Asian</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/fastfood.png" alt="Fast Food Image" class="category_img">
              <p class="category_text"><a href="#">Fast Food</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/mexico.png" alt="Mexican Image" class="category_img">
              <p class="category_text"><a href="#">Mexican</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/bbq.png" alt="BBQ Image" class="category_img">
              <p class="category_text"><a href="#">Barbecue</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/healthy.png" alt="Healthy Food Image" class="category_img">
              <p class="category_text"><a href="#">Healthy</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/coffee.png" alt="Coffee Image" class="category_img">
              <p class="category_text"><a href="#">Cafes</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/milktea.png" alt="Milk Tea Image" class="category_img">
              <p class="category_text"><a href="#">Milk Tea</a></p>
            </div>
            <div class="category_item">
              <img src="images/category/dessert.png" alt="Dessert Image" class="category_img">
              <p class="category_text"><a href="#">Dessert</a></p>
            </div>
          </div>
        </section>

        <hr>
        <h2 class="category-title">Restaurants</h2>

        <div id="restaurant-list" class="restaurant-container">
          <!-- Restaurant items will be dynamically inserted here -->
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const customerPostcode = localStorage.getItem('customerPostcode');
            const searchButton = document.getElementById('search-button');
            const searchBox = document.getElementById('search-box');

            searchButton.addEventListener('click', function() {
                const keyword = searchBox.value;
                fetchRestaurants(customerPostcode, keyword);
            });

            // Fetch restaurants initially with an empty keyword
            fetchRestaurants(customerPostcode, '');

            function fetchRestaurants(postcode, keyword) {
                if (!postcode) {
                    alert('Customer postcode not found. Please search from the home page.');
                    return;
                }

                const url = `http://localhost:8081/customers/restaurants?customerPostcode=${postcode}&keyword=${keyword}&category=&distanceFrom=&distanceTo=&ratingFrom=&ratingTo=`;
                fetch(url)
                    .then(response => response.json())
                    .then(data => displayRestaurants(data))
                    .catch(error => console.error('Error fetching restaurants:', error));
            }

            function displayRestaurants(restaurants) {
                const restaurantList = document.getElementById('restaurant-list');
                restaurantList.innerHTML = ''; // Clear existing restaurants

                // Create rows for restaurants, 4 items per row
                let row;
                restaurants.slice(0, 12).forEach((restaurant, index) => {
                    if (index % 4 === 0) {
                        row = document.createElement('div');
                        row.className = 'restaurant-row';
                        restaurantList.appendChild(row);
                    }
                    const restaurantItem = document.createElement('div');
                    restaurantItem.className = 'restaurant';
                    const imageSrc = `images/restaurants/${restaurant.category}.png`; // Image based on category

                    restaurantItem.innerHTML = `
                        <img src="${imageSrc}" alt="${restaurant.name}" class="restaurant-img">
                        <p class="restaurant-name">${restaurant.name || 'No name'}</p>
                        <span class="rating">${restaurant.stars || 'No rating'} stars</span>
                        <span class="distance">${restaurant.distance || '1'} km</span>
                    `;
                    row.appendChild(restaurantItem);
                });

                if (restaurants.length === 0) {
                    restaurantList.innerHTML = '<p>No restaurants found.</p>';
                }
            }
        });
    </script>
</body>

</html>
