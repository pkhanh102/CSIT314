<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurant Menu</title>
    <link rel="stylesheet" href="restaurantPage.css">
</head>

<body>
    <header>
        <!-- NAVIGATION BAR -->
        <h1 class="logo_name">ROCKETMEAL</h1>
        <div>
            <p class="logo_description">30 minutes</p>
            <ul class="navigation_bar">
                <li class="nav_list" onclick="logOut()"><a href="">Logout</a></li>
                <li class="nav_list"><a href="">About Us</a></li>
                <li class="nav_list"><a href="">Food Categories</a></li>
                <li class="nav_list"><a href="index.html">Home</a></li>
            </ul>
        </div>
    </header>

    <main>
        <!-- SHOPPING CART-->
        <div class="cart_container">
            <form action="enter-page.html" method="post">
                <!-- Enter next page here -->
                <button type="submit">
                    <input class="cart_logo" type="image" src="images/cart.png" alt="Shopping Cart">
                </button>
            </form>
        </div>

        <!-- RESTAURANT LOGO, COVER & INFO-->
        <div class="restaurant_logo">
            <div class="restaurant_cover">
                <img class="logo_cover" src="images/macca-cover.jpeg" alt="Restaurant Cover">
                <div class="restaurant_avatar">
                    <img class="logo_avatar" src="images/macca-logo.png" alt="Restaurant Cover">
                </div>
            </div>
            
            

            <div class="restaurant_info">
                <div class="restaurant_info_left">
                    <div class="header_with_button">
                        <p class="restaurant_name"></p>
                        <button style="margin-bottom: 20px;" class="add_button_header" id="change_restaurant_info" onclick="location.href='restaurantInfo.html'">
                            <img src="images/change.png" alt="">
                        </button>
                    </div>

                    <div class="text_img" style="width: 90%; margin: auto;">
                        <img class="star_img" src="images/star.png" alt="Star Image">
                        <p class="star_text"></p>
                    </div>
                </div>

                <div class="restaurant_address">
                    <div class="text_img">
                        <img class="info_img" src="images/location-img.png" alt="Location Image">
                        <p class="info_text info_address"></p>
                    </div>

                    <hr>
                    <div class="text_img" style="padding-top: 20px;">
                        <img class="info_img" src="images/clock.png" alt="Clock Image">
                        <p class="info_text" style="color: green;">Open to 10PM</p>
                    </div>

                    <hr>
                    <div class="text_img" style="padding-top: 20px;">
                        <img class="info_img" src="images/phone-call.png" alt="Phone Image">
                        <p class="info_text info_phone"></p>
                    </div>
                </div>

            </div>
        </div>

        <!-- BEST SELLER -->
        <div class="best_seller_container">
            <div class="header_with_button">
                <h2 class="best_header">Best Seller</h2>
                <button style="margin-bottom: 20px;" class="add_button_header" id="change_best_seller" onclick="location.href='addBestItem.html'">
                    <img src="images/change.png" alt="">
                </button>
            </div>

            <div class="best_items_container">
            </div>
        </div>

        <!-- FULL MENU -->
        <div class="menu_container">
            <div class="header_with_button">
                <h2 class="best_header">Full menu</h2>
                <button style="margin-bottom: 20px;" class="add_button_header" id="change_menu" onclick="location.href='adjustItem.html'">
                    <img src="images/change.png" alt="">
                </button>
            </div>

            <div class="menu_items_container">
            </div>
        </div>
    </main>

    <footer>
        <p>Are you a partner of ROCKETMEAL?<a> Click here to go to partner's page</a></p>
        <p>&copy; 2024 ROCKETMEAL</p>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const restaurantId = localStorage.getItem('restaurantId'); // Lấy restaurantId từ localStorage
            if(!restaurantId)
                window.location.href = '/FrontEndRestaurant/restaurantLogin.html'

            // Gọi hàm fetch để lấy danh sách món ăn
            fetchDishes();
    
            function fetchDishes() {
                fetch(`http://localhost:8081/restaurants/profile?id=${restaurantId}`)
                    .then(response => response.json())
                    .then(data => {
                        console.log(data);
                        if(data.restaurantDto)
                            displayRestaurant(data, data.restaurantDto);
                        if(data.dishDtoList.length > 0)
                            displayDishes(data.dishDtoList);
                        if(data.bestsellerDishDtoList.length > 0)
                            displayBestSeller(data.bestsellerDishDtoList);
                    })
                    .catch(error => console.error('Error fetching dishes:', error));
            }

            function displayBestSeller(dishes) {
                const bestSellerContainer = document.querySelector('.best_items_container');
    
                // Xóa các món ăn hiện tại
                bestSellerContainer.innerHTML = '';
    

                dishes.forEach(dish => {
                    const dishElement = createDishElement(dish);
                    bestSellerContainer.appendChild(dishElement);
                });
            }
    
            function displayDishes(dishes) {
                const fullMenuContainer = document.querySelector('.menu_items_container');
    
                // Xóa các món ăn hiện tại
                fullMenuContainer.innerHTML = '';
    

                dishes.forEach(dish => {
                    const dishElement = createDishElement(dish);
                    fullMenuContainer.appendChild(dishElement);
                });
            }
    
            function createDishElement(dish) {
                const dishDiv = document.createElement('div');
                const data = dish.image;

                const url = 'data:image/png;base64,' + data;

                dishDiv.classList.add('best_img');


                dishDiv.innerHTML = `
                    <img class="best_item_img" src="${url}" alt="${dish.name} Image">
                    <button class="add_button" onclick="localStorage.setItem('itemId', ${dish.id});location.href = 'edititem.html';">
                        <span style="position: relative; top: -5px;">...</span>
                    </button>
                    <p class="best_text">${dish.name}<br>$${dish.price}</p>
                `;

                return dishDiv;
            }
    
            function displayRestaurant(data, info) {
                console.log(info);
                const restaurantNames = document.querySelectorAll('.restaurant_name');
                restaurantNames[0].textContent = info.name;
                const starts = document.querySelectorAll('.star_text');
                starts[0].textContent = info.stars + '/5';
                const info_texts = document.querySelectorAll('.info_address');
                info_texts[0].textContent = data.address;
                const phone = document.querySelectorAll('.info_phone');
                phone[0].textContent = data.phone;
                //const starts = document.querySelectorAll('.star_text');
                //starts[0].textContent = info.stars + '/5';
            }
            
        });

        function logOut() {
            localStorage.removeItem("restaurantId");
            window.location.href = "/FrontEndRestaurant/restaurantLogin.html";
        }
    </script>
    
</body>

</html>
