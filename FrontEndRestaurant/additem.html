<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Item</title>
    <link rel="stylesheet" href="itemAdjust.css">
</head>
<body>
    <header>
        <!-- NAVIGATION BAR -->
        <h1 class="logo_name">ROCKETMEAL</h1>
        <div>
            <p class="logo_description">30 minutes</p>
            <ul class="navigation_bar">
                <li class="nav_list"><a href="">Login</a></li>
                <li class="nav_list"><a href="">About Us</a></li>
                <li class="nav_list"><a href="">Food Categories</a></li>
                <li class="nav_list"><a href="index.html">Home</a></li>
            </ul>
        </div>
    </header>

    <main>
        <div class="box">
            <p style="color: #000; font-size: 30px; font-weight: bold; text-align:center;">Add Item</p>
            <form id="addForm">
                <div class="input">
                    <label style="font-weight: bold; padding-right: 90px;">Item name</label>
                    <input type="text" id="itemname" name="itemname">
                </div>
                <div class="input">
                    <label style="font-weight: bold; padding-right: 80px;">Description</label>
                    <input type="text" id="description" name="description">
                </div>
                <div class="input">
                    <label style="font-weight: bold; padding-right: 130px;">Price</label>
                    <input type="number" id="price" name="price">
                </div>
                <div class="input">
                    <label style="font-weight: bold; padding-right: 70px;">Upload Image</label>
                    <input style="margin-left: -4px;" type="file" id="imageUpload" name="imageUpload" accept="image/*">
                </div>
                <div class="image-preview" id="imagePreview">
                    <img src="" alt="Image Preview" class="imageDisplay" style="display:none;">
                    <span class="defaultText">Image Preview</span>
                </div>
            </form>
        </div>
        <div class="button-container">
            <button class="custom-button" type="button" onclick="cancelAdd()">Cancel</button>
            <button class="custom-button" type="button" onclick="saveAdd()">Done</button>
        </div>
    </main>

    <footer>
        <p>Are you a partner of ROCKETMEAL?<a> Click here to go to partner's page</a></p>
        <p>&copy; 2024 ROCKETMEAL</p>
    </footer>

    <script>
        function cancelAdd() {
            window.location.href = 'adjustItem.html';
        }

        function saveAdd() {
            const file = document.getElementById('imageUpload').files[0];
            
            if (!file) {
                alert('Please select a file to upload.');
                return;
            }

            const reader = new FileReader();
            reader.readAsArrayBuffer(file);
            reader.onloadend = function () {
                const arrayBuffer = reader.result;
                const byteArray = new Uint8Array(arrayBuffer);
                const binaryString = String.fromCharCode.apply(null, byteArray);

                const formData = new FormData();
                formData.append('image', btoa(binaryString)); // Convert binary string to base64

                const itemData = {
                    restaurantId: parseInt(localStorage.getItem('restaurantId')),
                    name: document.getElementById('itemname').value,
                    description: document.getElementById('description').value,
                    price: parseFloat(document.getElementById('price').value)
                };

                for (let key in itemData) {
                    formData.append(key, itemData[key]);
                }

                fetch('http://localhost:8081/restaurants/food/dish', {
                    method: 'PUT', // PUT request to create a new item
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message === 'Dish added') {
                        alert('Item added successfully');
                        //window.location.href = 'adjustItem.html';
                    } else {
                        alert('Add failed: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            };
        }
    </script>
    <script src="imagePreview.js"></script>
</body>
</html>
